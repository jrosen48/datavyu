<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>datavyu R package update</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joshua Rosenberg, Mekenzie Meadows, and the Human Analysis Team" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# datavyu R package update
### Joshua Rosenberg, Mekenzie Meadows, and the Human Analysis Team
### T(CA)<span class="math inline"><em></em><sup>2</sup></span>
### 2020/08/10

---




# Outline

1. Background
1. Summarizing a column
1. Plotting a column summary
1. Preparing and plotting time series data
1. Next steps &amp; discussion

---

class: center, middle

# Background

---

# A look at datavyu (the qualitative audiovisual coding software)

![datavyu look](/media/annotated-datavyu-desktop.png)

---

A short (2 min.) video: https://datavyu.org/user-guide/guide.html

---

# A look at datavyu data

![screenshot of datavyu files 1](media/ss-1.png)

---

# A look at datavyu data

![screenshot of datavyu files 2](media/ss-2.png)

See more in this vignette on how to make this data:

---

# Big tasks/ideas guiding this update

1. Summarizing a column
1. Plotting a column summary
1. Preparing and plotting time series data

---

# But first: Exploring the columns and files

First, let's load the package.


```r
# devtools::install_github("tca2/datavyu")
library(datavyu)
```

Using {datavyu}, you can find the unique columns across all of the files in a directory.


```r
find_unique_columns("ex-data/datavyu_output_07-06-2020_14-46")
```

```
## [1] "LogClass_AS_ActivityFormat"      "LogClass_AS_ParticipationFormat" "LogClass_IG"                    
## [4] "LogClass_TO_MathPresent"         "LogClass_IS"                     "LogNotes"                       
## [7] "LogClass_TaskUsed"
```

---

# But first: Exploring the columns and files

You can also find unique files


```r
find_unique_files("ex-data/datavyu_output_07-06-2020_14-46")
```

```
## [1] "MM T102 14-02-17 Content Log"     "NM 14-12-03 T201 Content Log v.3" "NM T401 14-11-21 Content Log v.2"
```

---

class: center, middle

# Big task #1: Summarizing a column

---

# Summarizing a column

{datavyu} can help to summarize a column. It defaults to summarizing 
the frequency of codes for a specified column.


```r
summarize_column(column = "LogClass_AS_ActivityFormat",
                 directory = "ex-data/datavyu_output_07-06-2020_14-46")
```

```
## # A tibble: 8 x 3
##   log_class_as_activity_format_code01     n percent
## * &lt;chr&gt;                               &lt;dbl&gt;   &lt;dbl&gt;
## 1 l                                       7  0.318 
## 2 sp                                      7  0.318 
## 3 a                                       2  0.0909
## 4 o                                       2  0.0909
## 5 aw                                      1  0.0455
## 6 class discussion?                       1  0.0455
## 7 class discussion? lecture?              1  0.0455
## 8 l??                                     1  0.0455
```

---

We'll be typing that folder file path a number of times. 

You can set an option that will mean that the folder file path you set will be used *by default*, though
you can over-ride it any time you like.


```r
options(directory = "ex-data/datavyu_output_07-06-2020_14-46")
```

---

We can also explore the frequencies *by file* by changing the `by_file` argument to 
`TRUE`.


```r
summarize_column(column = "LogClass_AS_ActivityFormat",
                 by_file = TRUE) %&gt;% 
  knitr::kable()
```



|file                             |log_class_as_activity_format_code01 |  n|   percent|
|:--------------------------------|:-----------------------------------|--:|---------:|
|MM T102 14-02-17 Content Log     |aw                                  |  1| 0.1000000|
|MM T102 14-02-17 Content Log     |l                                   |  3| 0.3000000|
|MM T102 14-02-17 Content Log     |sp                                  |  6| 0.6000000|
|NM 14-12-03 T201 Content Log v.3 |a                                   |  1| 0.3333333|
|NM 14-12-03 T201 Content Log v.3 |l                                   |  1| 0.3333333|
|NM 14-12-03 T201 Content Log v.3 |o                                   |  1| 0.3333333|
|NM T401 14-11-21 Content Log v.2 |a                                   |  1| 0.1111111|
|NM T401 14-11-21 Content Log v.2 |class discussion?                   |  1| 0.1111111|
|NM T401 14-11-21 Content Log v.2 |class discussion? lecture?          |  1| 0.1111111|
|NM T401 14-11-21 Content Log v.2 |l                                   |  3| 0.3333333|
|NM T401 14-11-21 Content Log v.2 |l??                                 |  1| 0.1111111|
|NM T401 14-11-21 Content Log v.2 |o                                   |  1| 0.1111111|
|NM T401 14-11-21 Content Log v.2 |sp                                  |  1| 0.1111111|

---

To summarize durations (instead of frequencies) by changing the `summary` argument,
which defaults to `"frequency"`, but can be changed to `"duration"`:


```r
summarize_column(column = "LogClass_AS_ActivityFormat",
                 summary = "duration")
```

```
## # A tibble: 8 x 3
##   log_class_as_activity_format_code01 duration     percent
## * &lt;chr&gt;                               &lt;chr&gt;          &lt;dbl&gt;
## 1 l                                   00:52:00:316  0.327 
## 2 a                                   00:27:16:305  0.172 
## 3 sp                                  00:25:18:250  0.159 
## 4 class discussion?                   00:20:39:356  0.130 
## 5 o                                   00:13:01:093  0.0820
## 6 aw                                  00:10:08:256  0.0638
## 7 l??                                 00:06:06:588  0.0385
## 8 class discussion? lecture?          00:04:20:950  0.0274
```

---

Columns of durations can also be summarized by file:


```r
summarize_column(column = "LogClass_AS_ActivityFormat",
                 by_file = TRUE,
                 summary = "duration") %&gt;% 
  knitr::kable()
```



|file                             |log_class_as_activity_format_code01 |duration     |   percent|
|:--------------------------------|:-----------------------------------|:------------|---------:|
|MM T102 14-02-17 Content Log     |l                                   |00:46:17:990 | 0.5756634|
|MM T102 14-02-17 Content Log     |sp                                  |00:23:59:473 | 0.2982919|
|MM T102 14-02-17 Content Log     |aw                                  |00:10:08:256 | 0.1260446|
|NM 14-12-03 T201 Content Log v.3 |a                                   |00:04:53:373 | 0.8984400|
|NM 14-12-03 T201 Content Log v.3 |o                                   |00:00:25:134 | 0.0769716|
|NM 14-12-03 T201 Content Log v.3 |l                                   |00:00:08:029 | 0.0245884|
|NM T401 14-11-21 Content Log v.2 |a                                   |00:22:22:932 | 0.3066854|
|NM T401 14-11-21 Content Log v.2 |class discussion?                   |00:20:39:356 | 0.2830317|
|NM T401 14-11-21 Content Log v.2 |o                                   |00:12:35:959 | 0.1726384|
|NM T401 14-11-21 Content Log v.2 |l??                                 |00:06:06:588 | 0.0837177|
|NM T401 14-11-21 Content Log v.2 |l                                   |00:05:34:297 | 0.0763434|
|NM T401 14-11-21 Content Log v.2 |class discussion? lecture?          |00:04:20:950 | 0.0595931|
|NM T401 14-11-21 Content Log v.2 |sp                                  |00:01:18:777 | 0.0179903|

---

class: center, middle

# Big task #2: Plotting a column summary

---

## Plotting the results of a summary of a column

{datavyu} can also help to plot the summary of a column:


```r
freq_summary &lt;- summarize_column(column = "LogClass_AS_ActivityFormat")

plot_column_summary(freq_summary)
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---

This also works by file---so long as the column is summarized by file:


```r
freq_summary &lt;- 
  summarize_column(column = "LogClass_AS_ActivityFormat",
                   by_file = TRUE, summary = "duration")

plot_column_summary(freq_summary)
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---

Similarly, if the output is for the duration, rather than the frequency, the durations are plotted:


```r
duration_summary &lt;- 
  summarize_column(column = "LogClass_AS_ActivityFormat",
                   summary = "duration")

plot_column_summary(duration_summary)
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

---

Like for frequency, these can be plotted by file:


```r
duration_summary_by_file &lt;- 
  summarize_column(column = "LogClass_AS_ActivityFormat",
                   summary = "duration",
                   by_file = TRUE)

plot_column_summary(duration_summary_by_file)
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;

---

Output can be passed between functions with the pipe operator:


```r
library(dplyr)

summarize_column(column = "LogClass_AS_ActivityFormat",
                 summary = "duration",
                 by_file = TRUE) %&gt;% 
  plot_column_summary()
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;

---

class: center, middle

# Big task #3: Preparing and plotting time series data

---

# Time series preparation and plot


```r
prepared_time_series &lt;- 
  prep_time_series(column = "LogClass_AS_ActivityFormat",
                                         specified_file = "MM T102 14-02-17 Content Log",
                                         directory = "ex-data/datavyu_output_07-06-2020_14-46")
```

---

The `units` argument defaults to "s", but can be changed to "m" (to round the data to minutes) 
or "ms" (to not round the data and to retain the units as milliseconds).

We can see how using milliseconds increases the number of data points:


```r
prepared_time_series_ms &lt;- 
  prep_time_series(column = "LogClass_AS_ActivityFormat",
                                            specified_file = "MM T102 14-02-17 Content Log",
                                            directory = "ex-data/datavyu_output_07-06-2020_14-46",
                                            units = "ms") # takes around .8s to run

prepared_time_series_ms
```

```
## # A tibble: 4,825,743 x 2
##        ts code 
##  *  &lt;int&gt; &lt;chr&gt;
##  1 235026 aw   
##  2 235027 aw   
##  3 235028 aw   
##  4 235029 aw   
##  5 235030 aw   
##  6 235031 aw   
##  7 235032 aw   
##  8 235033 aw   
##  9 235034 aw   
## 10 235035 aw   
## # … with 4,825,733 more rows
```

---

This time series data can then be plotted (using the data with the units as seconds):


```r
plot_time_series(prepared_time_series)
```

&lt;img src="presentation-2020-08-10_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;

---

class: center, middle

# Next steps and discussion

---

# Next steps

- plot_column_summary(duration_summary, summarize_across = "all")
- improving time series plotting 
- addressing many issues

---

# Feedback
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
